<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:jdbc="http://www.springframework.org/schema/jdbc"	
	xmlns:aop="http://www.springframework.org/schema/aop" 
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/jdbc  
		http://www.springframework.org/schema/jdbc/spring-jdbc-3.0.xsd
		http://www.springframework.org/schema/aop 
    	http://www.springframework.org/schema/aop/spring-aop-3.0.xsd 
		http://www.springframework.org/schema/tx 
		http://www.springframework.org/schema/tx/spring-tx-3.0.xsd     		
    	http://www.springframework.org/schema/context 
    	http://www.springframework.org/schema/context/spring-context-3.0.xsd">
    
    <bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">  
        <property name="locations">  
            <list>  
                <value>/WEB-INF/config/system.properties</value>  
            </list>  
        </property>  
    </bean>
    <bean id="baseParameters" class="com.mgnt.test.center.util.BaseParameters">  
        <property name="startTime">
        	<value>${START_TIMES}</value>  
        </property>
    </bean>
    <bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
		  <property name="driverClassName">
		  	<value>com.mysql.jdbc.Driver</value>
		  </property>
		  <property name="url">
		   	<value>jdbc:mysql://127.0.0.1:3306/test_center</value> 
		  </property>
		  <property name="username" value="root"></property>
		  <property name="password" value="root"></property>
	</bean>
	
	<bean id="sessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
		<property name="dataSource" ref="dataSource"></property>
		<property name="hibernateProperties" ref="hibernateProperties"></property>
		<property name="mappingLocations">
			<list>
                <value>classpath:com/mgnt/test/center/entity/*.hbm.xml</value>
			</list>
		</property>
	</bean>
	
	<bean name="hibernateProperties" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
		<property name="properties">
			<props>
				<prop key="hibernate.dialect">org.hibernate.dialect.MySQLInnoDBDialect</prop>
				<prop key="hibernate.show_sql">true</prop>
				<prop key="hibernate.format_sql">true</prop> 
	<!--		    <prop key="hibernate.hbm2ddl.auto">update</prop>-->
			</props>
		</property>
	</bean>
	
	
	
	<bean id="hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate">
		<property name="sessionFactory" ref="sessionFactory"></property>
	</bean>  
	
	
	<!-- Hibernate 事务管理  -->
	<bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">
		<property name="sessionFactory" ref="sessionFactory" />
		
	</bean>
	
	<!--  事务管理Template  -->
	<bean id="transactionTemplate"
		class="org.springframework.transaction.support.TransactionTemplate">
		<property name="transactionManager" ref="transactionManager" />
	</bean>
	
	<bean id="baseDao" class="com.mgnt.test.center.dao.impl.BaseDaoImpl">
		<property name="hibernateTemplate" ref="hibernateTemplate"></property>
		<property name="transactionTemplate" ref="transactionTemplate"></property>
	</bean>
	

	
	<!-- 使用AspectJ方式配置AOP -->
	<aop:aspectj-autoproxy proxy-target-class="true" />
	<aop:config proxy-target-class="true" />

    <!--  将事务控制切入到service的实现类中，即实现在业务逻辑层实现事务控制  -->
	<aop:config>
		<aop:pointcut expression="execution(* com.mgnt.test.center.service.impl.*.*(..))" id="transactionPointcut" />
		<!--  切入点的逻辑  -->
		<aop:advisor advice-ref="txAdvice" pointcut-ref="transactionPointcut" />
	</aop:config>
	
	<!--  哪些方法应用事务控制  -->
	<tx:advice id="txAdvice" transaction-manager="transactionManager">
		<tx:attributes>
		    <tx:method name="*" read-only="true" propagation="NOT_SUPPORTED"/>
		</tx:attributes>
	</tx:advice>
	
    <!-- SMTP邮件服务配置 -->
	<bean id="javaMailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
		<property name="javaMailProperties">
			<props>
				<prop key="mail.smtp.auth">true</prop>
				<prop key="mail.smtp.timeout">25000</prop>
				<!-- SSL连接配置 -->
				<!--
					<prop key="mail.smtp.starttls.enable">true</prop>  
					<prop key="mail.smtp.socketFactory.class">javax.net.ssl.SSLSocketFactory</prop>
				-->
			</props>
		</property>
	</bean>
	
	<!-- SMTP邮件异步发送 -->
	<bean id="taskExecutor" class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor">
		<!-- 核心线程数 -->
		<property name="corePoolSize" value="10" />
		<!-- 最大线程数 -->
		<property name="maxPoolSize" value="50" />
		<!-- 最大队列数 -->
		<property name="queueCapacity" value="10000" />
		<!-- 线程池维护线程所允许的空闲时间 -->
		<property name="keepAliveSeconds" value="60" />
	</bean>

	<!-- 国际化信息 -->  
	<bean id="messageSource" class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
		<property name="basenames">
			<list>
				<value>classpath:languages/i18n</value>
				<value>classpath:languages/sns</value>
			</list>
		</property>
		<property name="useCodeAsDefaultMessage" value="true" />
	</bean>
	
	<bean id="localeResolver" class="org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver"></bean>

	<!-- Freemarker属性文件 freemarker.properties -->
	<bean id="freemarkerProperties" class="org.springframework.beans.factory.config.PropertiesFactoryBean">     
		<property name="location" value="/WEB-INF/config/freemarker.properties"/>     
	</bean>     
	
	<!-- Freemarker配置 -->
	<bean id="freemarkerConfig" class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer">
	    <!-- 视图资源位置 -->
	    <property name="templateLoaderPath" value="/template" />
	    <property name="defaultEncoding" value="UTF-8" />
	    <!-- 直接将属性写在单独的.properties注入进来 -->
		<property name="freemarkerSettings" ref="freemarkerProperties"/>  
		<!-- 全局变量部分 -->     
		<property name="freemarkerVariables">
			<map>
				<entry key="@COMPANYNAME" value="" />   
 			</map>     
		</property>   
	</bean>	
	
	
	<!--  自动扫描任务服务类  -->
	<context:component-scan base-package="com.mgnt.test.center.service.intf"></context:component-scan>
	<context:component-scan base-package="com.mgnt.test.center.service.impl"></context:component-scan>
	
	<bean id="sysShortMessageServiceImpl" class="com.mgnt.test.center.util.SysShortMessageServiceImpl"></bean>
	
	<bean class="com.mgnt.test.center.util.CreateTimerScheduleUtil">
		<property name="sysShortMessageServiceImpl" ref="sysShortMessageServiceImpl"></property>
		<property name="baseParameters" ref="baseParameters"></property>
	</bean>
	
</beans>
